<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL"
  xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
  xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
  xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
  xmlns:camunda="http://camunda.org/schema/1.0/bpmn"
  id="Definitions_1"
  targetNamespace="http://example.com/bpmn">

  <bpmn:process id="PROC_SPONSORING" name="Sponsoring Prozess" isExecutable="true">

    <bpmn:startEvent id="StartEvent_1" name="Start"/>

    <bpmn:userTask id="Task_Plan" name="Leistungs- und Kapazitätsplan erstellen"
                   camunda:formKey="embedded:app:forms/plan_form.html"/>

    <bpmn:userTask id="Task_Preisliste" name="Preisliste erstellen"
                   camunda:formKey="embedded:app:forms/preisliste_form.html"/>

    <bpmn:userTask id="Task_Mappe" name="Sponsorenmappe erstellen"
                   camunda:formKey="embedded:app:forms/mappe_form.html"/>

    <!-- Fristen berechnen -->
    <bpmn:serviceTask id="Task_CalcDeadlines" name="Fristen berechnen"
                      camunda:class="de.demo.sollmodell.delegate.CalculateDeadlinesDelegate"/>

    <!-- Event-based Gateway -->
    <bpmn:eventBasedGateway id="Gateway_EventBased" name="Warte auf Timer oder Angebotsanforderung"/>

    <!-- Timer catch: 6 Monate vor Veranstaltung -->
    <bpmn:intermediateCatchEvent id="Catch_Timer" name="6 Monate vor der Veranstaltung">
      <bpmn:timerEventDefinition>
        <bpmn:timeDate>${sixMonthsBefore}</bpmn:timeDate>
      </bpmn:timerEventDefinition>
    </bpmn:intermediateCatchEvent>

    <!-- Message catch: Angebotsanforderung -->
    <bpmn:intermediateCatchEvent id="Catch_Message" name="Angebotsanforderung">
      <bpmn:messageEventDefinition messageRef="MSG_ANGEBOTSANFORDERUNG"/>
    </bpmn:intermediateCatchEvent>

    <bpmn:exclusiveGateway id="Gateway_OfferPossible" name="Angebot möglich?"/>

    <bpmn:userTask id="Task_OfferPossible" name="Angebot möglich? (prüfen)"
                   camunda:formKey="embedded:app:forms/angebot_moeglich_form.html"/>

    <bpmn:userTask id="Task_OfferWrite" name="Angebot schreiben"
                   camunda:formKey="embedded:app:forms/angebot_schreiben_form.html"/>

    <bpmn:userTask id="Task_OfferSend" name="Angebot verschicken"
                   camunda:formKey="embedded:app:forms/angebot_verschicken_form.html"/>

    <bpmn:userTask id="Task_RejectSponsors" name="Sponsoren absagen"
                   camunda:formKey="embedded:app:forms/sponsoren_absagen_form.html"/>

    <bpmn:endEvent id="End_NoSponsoring" name="Kein Sponsoring"/>
    <bpmn:endEvent id="End_OfferSent" name="Angebot verschickt"/>

    <!-- Sequence Flows -->
    <bpmn:sequenceFlow id="Flow_1" sourceRef="StartEvent_1" targetRef="Task_Plan"/>
    <bpmn:sequenceFlow id="Flow_2" sourceRef="Task_Plan" targetRef="Task_Preisliste"/>
    <bpmn:sequenceFlow id="Flow_3" sourceRef="Task_Preisliste" targetRef="Task_Mappe"/>
    <bpmn:sequenceFlow id="Flow_4" sourceRef="Task_Mappe" targetRef="Task_CalcDeadlines"/>
    <bpmn:sequenceFlow id="Flow_5" sourceRef="Task_CalcDeadlines" targetRef="Gateway_EventBased"/>

    <bpmn:sequenceFlow id="Flow_Timer" sourceRef="Gateway_EventBased" targetRef="Catch_Timer"/>
    <bpmn:sequenceFlow id="Flow_Msg" sourceRef="Gateway_EventBased" targetRef="Catch_Message"/>

    <bpmn:sequenceFlow id="Flow_Timer_toReject" sourceRef="Catch_Timer" targetRef="Task_RejectSponsors"/>
    <bpmn:sequenceFlow id="Flow_Reject_End" sourceRef="Task_RejectSponsors" targetRef="End_NoSponsoring"/>

    <bpmn:sequenceFlow id="Flow_Msg_toCheck" sourceRef="Catch_Message" targetRef="Task_OfferPossible"/>
    <bpmn:sequenceFlow id="Flow_Check_toGateway" sourceRef="Task_OfferPossible" targetRef="Gateway_OfferPossible"/>

    <bpmn:sequenceFlow id="Flow_No" sourceRef="Gateway_OfferPossible" targetRef="Task_RejectSponsors">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${offerPossible == false}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>

    <bpmn:sequenceFlow id="Flow_Yes" sourceRef="Gateway_OfferPossible" targetRef="Task_OfferWrite">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${offerPossible == true}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>

    <bpmn:sequenceFlow id="Flow_Write_toSend" sourceRef="Task_OfferWrite" targetRef="Task_OfferSend"/>
    <bpmn:sequenceFlow id="Flow_Send_toEnd" sourceRef="Task_OfferSend" targetRef="End_OfferSent"/>

  </bpmn:process>

  <bpmn:message id="MSG_ANGEBOTSANFORDERUNG" name="MSG_ANGEBOTSANFORDERUNG"/>

</bpmn:definitions>
